pipeline {
    agent any

    environment {
        repositoryName = 'flask-compose'
        dockerHubUsername = 'noaavisrur'
        ssh_key = '/var/lib/jenkins/google.pem'
        prod_server = ''
    }

    stages {
        stage('Install Google Cloud SDK') {
            steps {
                sh 'curl https://sdk.cloud.google.com | bash'
                sh 'exec -l $SHELL'
                sh 'gcloud init --disable-prompts'
            }
        }

        stage('Clean up & clone') {
            steps {
                sh 'sudo rm -rf *'
                sh 'git clone https://github.com/noaavisrur/flask-project.git'
            }
        }

        stage('Turn on GCP Instance') {
            steps {
                script {
                    // Define the GCP instance ID and project ID
                    def instanceId = '5240862386400511472'
                    def projectId = 'disco-rope-393211'

                    // Turn on the GCP instance
                    sh "gcloud compute instances start ${instanceId} --project=${projectId}"

                    // Sleep for 1 minute to allow instances to start up
                    sleep 60

                    // Retrieve the internal IP address of the GCP instance
                    def internalIp = sh(
                        script: "gcloud compute instances describe ${instanceId} --format='get(networkInterfaces[0].networkIP)' --project=${projectId}",
                        returnStdout: true
                    ).trim()

                    // Set the internal IP address to the 'prod_server' variable
                    prod_server = internalIp
                }
            }
        }

        stage('Build and Push Docker Image') {
            steps {
                dir('flask
